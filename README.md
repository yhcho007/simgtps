# Task Management System
## 구성 요소

### 1. main.py

`main.py`는 Flask 애플리케이션의 메인 파일로, 다음과 같은 기능을 제공합니다:

- **RESTful API**: 작업을 등록하고 조회할 수 있는 API 엔드포인트를 제공합니다.
- **백그라운드 프로세스 실행**: `sch.py`를 백그라운드에서 실행합니다.
- **신호 처리**: 프로세스가 종료될 때 관련된 모든 프로세스를 종료합니다.

#### 사용법

```bash
python main.py
```

### 2. dash_app.py
dash_app.py는 처음에는 streamlit를 이용했으나, Dash 가 더 가독성이 있는것 같아 Dash를 사용하는것으로 변경했습니다. 웹 기반 사용자 인터페이스를 제공합니다. 사용자들은 이 인터페이스를 통해 작업을 쉽게 관리하고, 등록, 시스템 자원을 모니터링 할 수 있습니다.
사용자로부터 taskid, taskname, subprocee_starttime, task_status를 입력받아 API에 POST 요청을 보내고, POST 응답을 표시합니다. 요청 입력란이 최상단에 위치하고, 그 아래로 막대 그래프, 테이블 데이터, 시스템 메트릭스, CPU 프로세스 데이터, 메모리 프로세스 데이터가 순서대로 표시됩니다.

## 주요 기능
작업 등록: 사용자가 새로운 작업을 등록할 수 있습니다.
작업 조회: 등록된 작업을 조회할 수 있습니다.
필터링: 특정 조건에 따라 작업을 필터링할 수 있습니다.

#### 사용법
```bash
streamlit run dash_app.py
```
브라우저에서 애플리케이션 보기:
애플리케이션이 실행되면 브라우저를 열고 http://127.0.0.1:8050로 이동하여 Dash 애플리케이션을 확인합니다.

### 3. sch.py
sch.py는 main.py에 의해 백그라운드에서 실행되는 스크립트로, 주기적으로 특정 작업을 수행합니다. 이 스크립트는 주로 데이터베이스와 상호작용하여 작업을 처리하는 데 사용됩니다.

#### 사용법
이 스크립트는 main.py에서 자동으로 실행됩니다. 별도로 실행하려면 다음 명령어를 사용할 수 있습니다.

```bash
python sch.py
```
### 4. app.py
app.py는 기동시간에 특정 작업을 수행하는 데 필요한 로직을 포함하고 있습니다. 이 스크립트는 taskid 인자를 받아서 작업을 처리합니다.

#### 사용법
이 스크립트는 sch.py에서 자동으로 실행됩니다. 별도로 실행하려면 다음 명령어를 사용할 수 있습니다.

```bash
python app.py --taskid <taskid>
```

### 테이블 정의
```bash
CREATE TABLE task (
    taskid NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    taskname VARCHAR2(100) NOT NULL,
    subprocee_starttime TIMESTAMP NOT NULL,
    task_status VARCHAR2(20) DEFAULT 'R' NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    changed_at TIMESTAMP
);

-- testcho 계정생성 권한 할당의 예
CREATE TABLESPACE TEST_TS
DATAFILE 'C:\app\로그인계정\product\23ai\oradata\FREE\TEST_TS.dbf' 
SIZE 50 M autoextend ON
NEXT 1 M maxsize 100 M;

CREATE TEMPORARY TABLESPACE TEST_TS_TEMP 
TEMPFILE 'C:\app\로그인계정\product\23ai\oradata\FREE\TEST_TS_TMP1.dbf' 
SIZE 100 M;

alter session set "_ORACLE_SCRIPT"=true;

CREATE USER testcho IDENTIFIED BY 1234
       DEFAULT   TABLESPACE TEST_TS
       TEMPORARY TABLESPACE TEST_TS_TEMP;

GRANT RESOURCE, CONNECT,DBA TO testcho;
```

## 요구 사항
Python 3.12.3
리눅스의 경우 gunicorn

## 설치
프로젝트를 클론한 후, 필요한 패키지를 설치합니다.

### requirements.txt
```bash
Flask==2.2.5
flask_restx==1.3.0
APScheduler==4.0.0a6
oracledb==3.1.0
pandas==2.2.3
dash==3.0.4
psutil==7.0.0
schedule==1.2.2
altair==5.5.0
streamlit-autorefresh==1.0.1
gunicorn==22.0.0
supervisor==4.2.5
mattermostdriver==7.3.2
```
이 내용을 requirements.txt 파일로 저장하면, 필요한 패키지를 쉽게 설치할 수 있습니다. 설치하려면 다음 명령어를 사용할 수 있습니다

```bash
pip install -r requirements.txt
```
패키지 의존성에 의해 추가적인 패키지 들이 설치 될 수있는데, requirements.txt 로 설치 후 pip freeze > requirements_full.txt 하여 requirements_full.txt 에서 확인 바랍니다. 

패쇠망에서는 패키지의 모든 wheel 파일이 있어야 패키지 설치가 가능하므로, 패쇄망 내에서 python 모든 패키지와 의존성 있는 모든 패키지 설치를 위해, 의존성이 있는 모든 wheel 파일을 다운 받기위해서는 다음과 같이 합니다.
```bash
pip download -r requirements.txt --no-binary :all --no-cache-dir --dest <다운로드 경로>
```

패키지간 의존성 추적 [pipdeptree](https://pypi.org/project/pipdeptree/) 을 사용해서 합니다. 설치된 패키지간 의존성은 다음과 충돌이나 싸이클 없음을 알 수 있다.
```bash
pipdeptree -r -p Flask,flask_restx,APScheduler,oracledb,pandas,dash,psutil,schedule,streamlit,streamlit_autorefresh,altair,gunicorn,supervisor,mattermostdriver
altair==5.5.0
└── streamlit==1.45.1 [requires: altair>=4.0,<6]
    └── streamlit-autorefresh==1.0.1 [requires: streamlit>=0.75]
APScheduler==4.0.0a6
Flask==3.0.3
├── dash==3.0.4 [requires: Flask>=1.0.4,<3.1]
└── flask-restx==1.3.0 [requires: Flask>=0.8,!=2.0.0]
gunicorn==22.0.0
mattermostdriver==7.3.2
oracledb==3.1.0
pandas==2.2.3
└── streamlit==1.45.1 [requires: pandas>=1.4.0,<3]
    └── streamlit-autorefresh==1.0.1 [requires: streamlit>=0.75]
psutil==7.0.0
schedule==1.2.2
supervisor==4.2.5

```
이 패키지들과 의존성이 있는 전체 패키지는 다음과 같다.

pipdeptree 는 다음과 같이 설치 한다.
```bash
pip install pipdeptree
```

```bash
pipdeptree -p Flask,flask_restx,APScheduler,oracledb,pandas,dash,psutil,schedule,streamlit,streamlit_autorefresh,altair,gunicorn,supervisor,mattermostdriver
APScheduler==4.0.0a6
├── anyio [required: ~=4.0, installed: 4.9.0]
│   ├── idna [required: >=2.8, installed: 3.10]
│   ├── sniffio [required: >=1.1, installed: 1.3.1]
│   └── typing_extensions [required: >=4.5, installed: 4.13.2]
├── attrs [required: >=22.1, installed: 25.3.0]
├── tenacity [required: >=8.0,<10.0, installed: 9.1.2]
└── tzlocal [required: >=3.0, installed: 5.3.1]
    └── tzdata [required: Any, installed: 2025.2]
dash==3.0.4
├── Flask [required: >=1.0.4,<3.1, installed: 3.0.3]
│   ├── Werkzeug [required: >=3.0.0, installed: 3.0.6]
│   │   └── MarkupSafe [required: >=2.1.1, installed: 3.0.2]
│   ├── Jinja2 [required: >=3.1.2, installed: 3.1.6]
│   │   └── MarkupSafe [required: >=2.0, installed: 3.0.2]
│   ├── itsdangerous [required: >=2.1.2, installed: 2.2.0]
│   ├── click [required: >=8.1.3, installed: 8.2.0]
│   │   └── colorama [required: Any, installed: 0.4.6]
│   └── blinker [required: >=1.6.2, installed: 1.9.0]
├── Werkzeug [required: <3.1, installed: 3.0.6]
│   └── MarkupSafe [required: >=2.1.1, installed: 3.0.2]
├── plotly [required: >=5.0.0, installed: 6.1.0]
│   ├── narwhals [required: >=1.15.1, installed: 1.40.0]
│   └── packaging [required: Any, installed: 24.2]
├── importlib_metadata [required: Any, installed: 8.7.0]
│   └── zipp [required: >=3.20, installed: 3.21.0]
├── typing_extensions [required: >=4.1.1, installed: 4.13.2]
├── requests [required: Any, installed: 2.32.3]
│   ├── charset-normalizer [required: >=2,<4, installed: 3.4.2]
│   ├── idna [required: >=2.5,<4, installed: 3.10]
│   ├── urllib3 [required: >=1.21.1,<3, installed: 2.4.0]
│   └── certifi [required: >=2017.4.17, installed: 2025.4.26]
├── retrying [required: Any, installed: 1.3.4]
│   └── six [required: >=1.7.0, installed: 1.17.0]
├── nest-asyncio [required: Any, installed: 1.6.0]
└── setuptools [required: Any, installed: 80.7.1]
flask-restx==1.3.0
├── aniso8601 [required: >=0.82, installed: 10.0.1]
├── jsonschema [required: Any, installed: 4.23.0]
│   ├── attrs [required: >=22.2.0, installed: 25.3.0]
│   ├── jsonschema-specifications [required: >=2023.03.6, installed: 2025.4.1]
│   │   └── referencing [required: >=0.31.0, installed: 0.36.2]
│   │       ├── attrs [required: >=22.2.0, installed: 25.3.0]
│   │       ├── rpds-py [required: >=0.7.0, installed: 0.25.0]
│   │       └── typing_extensions [required: >=4.4.0, installed: 4.13.2]
│   ├── referencing [required: >=0.28.4, installed: 0.36.2]
│   │   ├── attrs [required: >=22.2.0, installed: 25.3.0]
│   │   ├── rpds-py [required: >=0.7.0, installed: 0.25.0]
│   │   └── typing_extensions [required: >=4.4.0, installed: 4.13.2]
│   └── rpds-py [required: >=0.7.1, installed: 0.25.0]
├── Flask [required: >=0.8,!=2.0.0, installed: 3.0.3]
│   ├── Werkzeug [required: >=3.0.0, installed: 3.0.6]
│   │   └── MarkupSafe [required: >=2.1.1, installed: 3.0.2]
│   ├── Jinja2 [required: >=3.1.2, installed: 3.1.6]
│   │   └── MarkupSafe [required: >=2.0, installed: 3.0.2]
│   ├── itsdangerous [required: >=2.1.2, installed: 2.2.0]
│   ├── click [required: >=8.1.3, installed: 8.2.0]
│   │   └── colorama [required: Any, installed: 0.4.6]
│   └── blinker [required: >=1.6.2, installed: 1.9.0]
├── Werkzeug [required: !=2.0.0, installed: 3.0.6]
│   └── MarkupSafe [required: >=2.1.1, installed: 3.0.2]
├── pytz [required: Any, installed: 2025.2]
└── importlib_resources [required: Any, installed: 6.5.2]
gunicorn==22.0.0
└── packaging [required: Any, installed: 24.2]
mattermostdriver==7.3.2
├── websockets [required: >=8, installed: 15.0.1]
└── requests [required: >=2.25, installed: 2.32.3]
    ├── charset-normalizer [required: >=2,<4, installed: 3.4.2]
    ├── idna [required: >=2.5,<4, installed: 3.10]
    ├── urllib3 [required: >=1.21.1,<3, installed: 2.4.0]
    └── certifi [required: >=2017.4.17, installed: 2025.4.26]
oracledb==3.1.0
└── cryptography [required: >=3.2.1, installed: 45.0.2]
    └── cffi [required: >=1.14, installed: 1.17.1]
        └── pycparser [required: Any, installed: 2.22]
psutil==7.0.0
schedule==1.2.2
streamlit-autorefresh==1.0.1
└── streamlit [required: >=0.75, installed: 1.45.1]
    ├── altair [required: >=4.0,<6, installed: 5.5.0]
    │   ├── Jinja2 [required: Any, installed: 3.1.6]
    │   │   └── MarkupSafe [required: >=2.0, installed: 3.0.2]
    │   ├── jsonschema [required: >=3.0, installed: 4.23.0]
    │   │   ├── attrs [required: >=22.2.0, installed: 25.3.0]
    │   │   ├── jsonschema-specifications [required: >=2023.03.6, installed: 2025.4.1]
    │   │   │   └── referencing [required: >=0.31.0, installed: 0.36.2]
    │   │   │       ├── attrs [required: >=22.2.0, installed: 25.3.0]
    │   │   │       ├── rpds-py [required: >=0.7.0, installed: 0.25.0]
    │   │   │       └── typing_extensions [required: >=4.4.0, installed: 4.13.2]
    │   │   ├── referencing [required: >=0.28.4, installed: 0.36.2]
    │   │   │   ├── attrs [required: >=22.2.0, installed: 25.3.0]
    │   │   │   ├── rpds-py [required: >=0.7.0, installed: 0.25.0]
    │   │   │   └── typing_extensions [required: >=4.4.0, installed: 4.13.2]
    │   │   └── rpds-py [required: >=0.7.1, installed: 0.25.0]
    │   ├── narwhals [required: >=1.14.2, installed: 1.40.0]
    │   ├── packaging [required: Any, installed: 24.2]
    │   └── typing_extensions [required: >=4.10.0, installed: 4.13.2]
    ├── blinker [required: >=1.5.0,<2, installed: 1.9.0]
    ├── cachetools [required: >=4.0,<6, installed: 5.5.2]
    ├── click [required: >=7.0,<9, installed: 8.2.0]
    │   └── colorama [required: Any, installed: 0.4.6]
    ├── numpy [required: >=1.23,<3, installed: 2.2.6]
    ├── packaging [required: >=20,<25, installed: 24.2]
    ├── pandas [required: >=1.4.0,<3, installed: 2.2.3]
    │   ├── numpy [required: >=1.26.0, installed: 2.2.6]
    │   ├── python-dateutil [required: >=2.8.2, installed: 2.9.0.post0]
    │   │   └── six [required: >=1.5, installed: 1.17.0]
    │   ├── pytz [required: >=2020.1, installed: 2025.2]
    │   └── tzdata [required: >=2022.7, installed: 2025.2]
    ├── pillow [required: >=7.1.0,<12, installed: 11.2.1]
    ├── protobuf [required: >=3.20,<7, installed: 6.31.0]
    ├── pyarrow [required: >=7.0, installed: 20.0.0]
    ├── requests [required: >=2.27,<3, installed: 2.32.3]
    │   ├── charset-normalizer [required: >=2,<4, installed: 3.4.2]
    │   ├── idna [required: >=2.5,<4, installed: 3.10]
    │   ├── urllib3 [required: >=1.21.1,<3, installed: 2.4.0]
    │   └── certifi [required: >=2017.4.17, installed: 2025.4.26]
    ├── tenacity [required: >=8.1.0,<10, installed: 9.1.2]
    ├── toml [required: >=0.10.1,<2, installed: 0.10.2]
    ├── typing_extensions [required: >=4.4.0,<5, installed: 4.13.2]
    ├── watchdog [required: >=2.1.5,<7, installed: 6.0.0]
    ├── GitPython [required: >=3.0.7,<4,!=3.1.19, installed: 3.1.44]
    │   └── gitdb [required: >=4.0.1,<5, installed: 4.0.12]
    │       └── smmap [required: >=3.0.1,<6, installed: 5.0.2]
    ├── pydeck [required: >=0.8.0b4,<1, installed: 0.9.1]
    │   ├── Jinja2 [required: >=2.10.1, installed: 3.1.6]
    │   │   └── MarkupSafe [required: >=2.0, installed: 3.0.2]
    │   └── numpy [required: >=1.16.4, installed: 2.2.6]
    └── tornado [required: >=6.0.3,<7, installed: 6.5]
supervisor==4.2.5
└── setuptools [required: Any, installed: 80.7.1]
```

## docker-compose up 으로 기동하기
이 docker-compose.yml 파일이 있는 디렉토리에서 터미널을 열고 docker-compose up --build 명령어를 실행하면 이미지를 빌드하고 컨테이너를 실행할 수 있어! 
--build는 변경사항이 있을 때 이미지를 다시 빌드하라는 뜻이야. 백그라운드로 실행하고 싶으면 -d 옵션을 추가해서 docker-compose up -d --build 라고 하면 돼.
자, 이렇게 해서 네 Flask+Dash 앱을 Openshift 환경에 배포하기 위한 기본적인 Dockerfile과 docker-compose.yml, 설정 파일들을 만들어봤어! 😊

이 파일들과 함께 네 파이썬 코드(main.py, dash_app.py, sch.py)를 같은 디렉토리에 넣고 docker-compose up --build 로 로컬에서 먼저 테스트해보는 걸 추천해! 
포트 5000으로 API (http://localhost:5000/swagger 로 Swagger UI 확인 가능!) 접근이 되는지, 8501 포트로 Dash 앱이 잘 뜨는지 확인해봐!

Openshift 배포 자체는 oc 명령어나 웹 콘솔을 사용하게 될 텐데, 이 Dockerfile을 바탕으로 이미지를 빌드하고 Openshift DeploymentConfig/Deployment를 생성하면 돼. 
Openshift 환경에서의 세부 설정(Route, Secret, Resource Limit 등)은 프로젝트 특성에 맞게 추가로 설정해야 해


## 라이센스
이 프로젝트는 MIT 라이센스 하에 배포됩니다.


### 설명

- **프로젝트 개요**: 프로젝트의 목적과 기능을 간단히 설명합니다.
- **구성 요소**: 각 스크립트의 기능과 사용법을 자세히 설명합니다.
- **요구 사항**: 이 프로젝트를 실행하기 위해 필요한 라이브러리와 패키지를 나열합니다.
- **설치 방법**: 프로젝트를 설치하는 방법을 안내합니다.
- **라이센스**: 프로젝트의 라이센스를 명시합니다.

### 에러처리
#### pip 에러
from pip._internal.cli.main import main as _main
ModuleNotFoundError: No module named 'pip._internal'

위와 같은 에러가 발생하여, 다음과 같이 처리하고 패키지 삭제 후 다시 설치함.
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py

python get-pip.py

### 참고한 URL 감사합니다!!! Thank you for the reference URL!!!
[Oracle Database 23ai Free Platforms windows 버전설치](https://download.oracle.com/otn-pub/otn_software/db-express/WINDOWS.X64_238000_free.zip)

[Oracle-오라클-계정-생성-삭제-테이블-스페이스-생성-삭제-계정-권한-부여](https://daftcoder.tistory.com/entry/Oracle-%EC%98%A4%EB%9D%BC%ED%81%B4-%EA%B3%84%EC%A0%95-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%EA%B3%84%EC%A0%95-%EA%B6%8C%ED%95%9C-%EB%B6%80%EC%97%AC)

[Install local wheel file with requirements.txt]https://stackoverflow.com/questions/62956690/install-local-wheel-file-with-requirements-txt

[wrtn.ai]https://wrtn.ai/



